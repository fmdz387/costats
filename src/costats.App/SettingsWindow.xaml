<Window x:Class="costats.App.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:costats.App"
        Title="Settings"
        Width="360"
        SizeToContent="Height"
        WindowStyle="None"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        Topmost="True"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterScreen">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0"
                      ResizeBorderThickness="0"
                      CornerRadius="16"
                      GlassFrameThickness="-1"
                      UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <!-- Light color palette with WCAG AA contrast -->
        <Color x:Key="BgColor">#F5F3FA</Color>
        <Color x:Key="TextPrimary">#1E1B2E</Color>
        <Color x:Key="TextSecondary">#3D3A52</Color>
        <Color x:Key="TextMuted">#5C5975</Color>
        <Color x:Key="TextFaint">#6E6B86</Color>
        <Color x:Key="DividerColor">#D5D2E4</Color>
        <Color x:Key="AccentColor">#6366F1</Color>

        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimary}" />
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondary}" />
        <SolidColorBrush x:Key="TextMutedBrush" Color="{StaticResource TextMuted}" />
        <SolidColorBrush x:Key="TextFaintBrush" Color="{StaticResource TextFaint}" />
        <SolidColorBrush x:Key="DividerBrush" Color="{StaticResource DividerColor}" />
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}" />

        <!-- ComboBox Style -->
        <Style x:Key="SettingsComboBox" TargetType="ComboBox">
            <Setter Property="Background" Value="#FFFFFF" />
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource DividerBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <!-- CheckBox Style -->
        <Style x:Key="SettingsCheckBox" TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border x:Name="CheckBorder" Width="20" Height="20" CornerRadius="4"
                                    Background="#FFFFFF" BorderBrush="{StaticResource DividerBrush}" BorderThickness="1"
                                    VerticalAlignment="Center">
                                <Path x:Name="CheckMark" Data="M3,7 L7,11 L13,3" Stroke="White" StrokeThickness="2"
                                      Visibility="Collapsed" HorizontalAlignment="Center" VerticalAlignment="Center"
                                      Width="12" Height="10" Stretch="Uniform" />
                            </Border>
                            <ContentPresenter Margin="10,0,0,0" VerticalAlignment="Center" />
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckBorder" Property="Background" Value="{StaticResource AccentBrush}" />
                                <Setter TargetName="CheckBorder" Property="BorderBrush" Value="{StaticResource AccentBrush}" />
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="CheckBorder" Property="BorderBrush" Value="{StaticResource AccentBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Button Style -->
        <Style x:Key="SettingsButton" TargetType="Button">
            <Setter Property="Background" Value="#0A000000" />
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource DividerBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="16,8" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#14000000" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1E000000" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border CornerRadius="16" BorderBrush="#30A0A0C0" BorderThickness="1"
            Background="#F5F3FA">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Header -->
            <DockPanel Grid.Row="0" Margin="0,0,0,16">
                <TextBlock Text="Settings" FontSize="18" FontWeight="SemiBold"
                           Foreground="{StaticResource TextPrimaryBrush}" DockPanel.Dock="Left" />
                <Button Content="X" Click="OnCloseClick" DockPanel.Dock="Right"
                        HorizontalAlignment="Right" Width="28" Height="28" Padding="0"
                        Style="{StaticResource SettingsButton}" FontWeight="SemiBold" />
            </DockPanel>

            <!-- Divider -->
            <Border Grid.Row="1" Height="1" Background="{StaticResource DividerBrush}" Margin="0,0,0,16" />

            <!-- Settings Content -->
            <StackPanel Grid.Row="2">

                <!-- System Section -->
                <TextBlock Text="SYSTEM" FontSize="10" FontWeight="SemiBold"
                           Foreground="{StaticResource TextMutedBrush}" Margin="0,0,0,12" />

                <CheckBox IsChecked="{Binding StartAtLogin}" Style="{StaticResource SettingsCheckBox}" Margin="0,0,0,6">
                    <TextBlock Text="Start at login" FontSize="12" Foreground="{StaticResource TextPrimaryBrush}" />
                </CheckBox>
                <TextBlock Text="Automatically launch costats when Windows starts."
                           FontSize="11" Foreground="{StaticResource TextFaintBrush}" Margin="30,0,0,16" />

                <!-- Divider -->
                <Border Height="1" Background="{StaticResource DividerBrush}" Margin="0,0,0,16" />

                <!-- Automation Section -->
                <TextBlock Text="AUTOMATION" FontSize="10" FontWeight="SemiBold"
                           Foreground="{StaticResource TextMutedBrush}" Margin="0,0,0,12" />

                <DockPanel Margin="0,0,0,6">
                    <TextBlock Text="Refresh interval" FontSize="12"
                               Foreground="{StaticResource TextPrimaryBrush}" DockPanel.Dock="Left"
                               VerticalAlignment="Center" />
                    <ComboBox ItemsSource="{Binding RefreshOptions}"
                              SelectedItem="{Binding SelectedRefreshOption}"
                              Style="{StaticResource SettingsComboBox}"
                              DockPanel.Dock="Right" HorizontalAlignment="Right" Width="120" />
                </DockPanel>
                <TextBlock Text="How often costats polls for usage data in the background."
                           FontSize="11" Foreground="{StaticResource TextFaintBrush}" Margin="0,0,0,0" />

                <!-- Divider -->
                <Border Height="1" Background="{StaticResource DividerBrush}" Margin="0,16,0,16" />

                <!-- Copilot Section -->
                <TextBlock Text="COPILOT (EXPERIMENTAL)" FontSize="10" FontWeight="SemiBold"
                           Foreground="{StaticResource TextMutedBrush}" Margin="0,0,0,12" />

                <CheckBox IsChecked="{Binding CopilotEnabled}" Style="{StaticResource SettingsCheckBox}" Margin="0,0,0,6">
                    <TextBlock Text="Enable GitHub Copilot usage" FontSize="12" Foreground="{StaticResource TextPrimaryBrush}" />
                </CheckBox>
                <TextBlock Text="Uses an unofficial GitHub endpoint and may break without notice."
                           FontSize="11" Foreground="{StaticResource TextFaintBrush}" Margin="30,0,0,12" TextWrapping="Wrap" />

                <TextBlock Text="Personal access token" FontSize="12" Foreground="{StaticResource TextPrimaryBrush}" />
                <PasswordBox x:Name="CopilotTokenBox" Margin="0,6,0,8" Height="28"
                             IsEnabled="{Binding IsCopilotTokenBusy, Converter={x:Static local:BoolNegationConverter.Instance}}" />

                <DockPanel Margin="0,0,0,6">
                    <Button Content="Save token"
                            Click="OnSaveCopilotTokenClick"
                            IsEnabled="{Binding IsCopilotTokenBusy, Converter={x:Static local:BoolNegationConverter.Instance}}"
                            Style="{StaticResource SettingsButton}"
                            DockPanel.Dock="Left" />
                    <Button Content="Clear token"
                            Command="{Binding ClearCopilotTokenCommand}"
                            IsEnabled="{Binding IsCopilotTokenBusy, Converter={x:Static local:BoolNegationConverter.Instance}}"
                            Style="{StaticResource SettingsButton}"
                            DockPanel.Dock="Right" />
                </DockPanel>

                <TextBlock Text="{Binding CopilotTokenStatus}" FontSize="11" Foreground="{StaticResource TextFaintBrush}"
                           Visibility="{Binding CopilotTokenStatus, Converter={x:Static local:StringToVisibilityConverter.Instance}}" />

                <!-- Divider -->
                <Border Height="1" Background="{StaticResource DividerBrush}" Margin="0,16,0,16" />

                <!-- Claude Code / Multicc Section -->
                <TextBlock Text="CLAUDE CODE" FontSize="10" FontWeight="SemiBold"
                           Foreground="{StaticResource TextMutedBrush}" Margin="0,0,0,12" />

                <!-- Shown when multicc is detected -->
                <StackPanel>
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding MulticcDetected}" Value="True">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <CheckBox IsChecked="{Binding MulticcEnabled}" Style="{StaticResource SettingsCheckBox}" Margin="0,0,0,6">
                        <TextBlock Text="Use multicc profiles" FontSize="12"
                                   Foreground="{StaticResource TextPrimaryBrush}" />
                    </CheckBox>
                    <TextBlock Text="Automatically detect and display all multicc profiles in the Claude tab."
                               FontSize="11" Foreground="{StaticResource TextFaintBrush}" Margin="30,0,0,12" />

                    <!-- Profile count info (visible when multicc enabled) -->
                    <StackPanel>
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding MulticcEnabled}" Value="True">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock FontSize="11" Foreground="{StaticResource TextFaintBrush}" Margin="0,0,0,4">
                            <Run Text="Profiles found:" />
                            <Run Text="{Binding MulticcProfileCount, Mode=OneWay}" FontWeight="SemiBold" />
                        </TextBlock>
                    </StackPanel>

                    <!-- Restart message -->
                    <TextBlock Text="{Binding MulticcRestartMessage}" FontSize="11" Foreground="#F97316" Margin="0,8,0,0"
                               Visibility="{Binding MulticcRestartMessage, Converter={x:Static local:StringToVisibilityConverter.Instance}}" />
                </StackPanel>

                <!-- Shown when multicc is NOT detected -->
                <StackPanel>
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding MulticcDetected}" Value="False">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="multicc not detected. Install multicc to manage multiple Claude Code accounts."
                               FontSize="11" Foreground="{StaticResource TextFaintBrush}" TextWrapping="Wrap" />
                </StackPanel>

                <!-- Divider -->
                <Border Height="1" Background="{StaticResource DividerBrush}" Margin="0,16,0,16" />

                <!-- Updates Section -->
                <TextBlock Text="UPDATES" FontSize="10" FontWeight="SemiBold"
                           Foreground="{StaticResource TextMutedBrush}" Margin="0,0,0,12" />

                <DockPanel>
                    <Button Content="Check for updates"
                            Command="{Binding CheckForUpdatesCommand}"
                            IsEnabled="{Binding IsCheckingForUpdates, Converter={x:Static local:BoolNegationConverter.Instance}}"
                            Style="{StaticResource SettingsButton}"
                            DockPanel.Dock="Right" HorizontalAlignment="Right" />
                    <TextBlock Text="{Binding UpdateStatusText}"
                               FontSize="11" Foreground="{StaticResource TextFaintBrush}"
                               VerticalAlignment="Center"
                               Visibility="{Binding UpdateStatusText, Converter={x:Static local:StringToVisibilityConverter.Instance}}" />
                </DockPanel>

            </StackPanel>

            <!-- Footer -->
            <StackPanel Grid.Row="3" Margin="0,16,0,0">
                <Border Height="1" Background="{StaticResource DividerBrush}" Margin="0,0,0,12" />
                <DockPanel>
                    <TextBlock Text="{Binding Version, StringFormat='v{0}'}"
                               FontSize="11" Foreground="{StaticResource TextMutedBrush}"
                               DockPanel.Dock="Right" HorizontalAlignment="Right"
                               VerticalAlignment="Center" />
                    <TextBlock Text="Changes are saved automatically."
                               FontSize="11" Foreground="{StaticResource TextFaintBrush}"
                               DockPanel.Dock="Left" VerticalAlignment="Center" />
                </DockPanel>
            </StackPanel>
        </Grid>
    </Border>
</Window>
